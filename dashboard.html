<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</head>
<body class="bg-light">
<nav class="navbar navbar-dark bg-primary mb-4">
  <div class="container-fluid">
    <span class="navbar-brand" id="greeting"></span>
    <button id="logout" class="btn btn-outline-light">Logout</button>
  </div>
</nav>

<div class="container">
  <div class="card shadow">
    <div class="card-body text-center">
      <h3>Welcome to your secure dashboard!</h3>
      <p>Only logged-in users can see this.</p>
    </div>
    <iframe src="https://skadigitalhub.github.io/workspace" width="100%" height="600" frameborder="0"></iframe>
  </div>
</div>

<script>
  const API_URL = 'https://script.google.com/macros/s/AKfycbxikiNIi81cPsekdg_z8yClvwGQbp92z-AMQrNixtw-yK1KN6ZUSyVAc_i-IUoMf4MQ2Q/exec';
  const token = localStorage.getItem('sessionToken');

  if (!token) location.href = 'login.html';

  async function api(action, data) {
    const resp = await fetch(API_URL, {
      method: 'POST',
      body: JSON.stringify({ action, ...data }),
      headers: { 'Content-Type': 'text/plain' }
    });
    return resp.json();
  }

  api('validateToken', { token }).then(res => {
    if (res.error) throw res.error;
    document.getElementById('greeting').textContent = `Hello, ${res.name}!`;
  }).catch(err => {
    Swal.fire('Session Expired', err, 'warning').then(() => {
      localStorage.removeItem('sessionToken');
      location.href = 'login.html';
    });
  });

  document.getElementById('logout').onclick = () => {
    localStorage.removeItem('sessionToken');
    location.href = 'login.html';
  };
</script>
</body>
</html>
